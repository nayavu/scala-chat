(function(e){function t(t){for(var a,c,o=t[0],i=t[1],d=t[2],u=0,l=[];u<o.length;u++)c=o[u],Object.prototype.hasOwnProperty.call(s,c)&&s[c]&&l.push(s[c][0]),s[c]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);m&&m(t);while(l.length)l.shift()();return r.push.apply(r,d||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,o=1;o<n.length;o++){var i=n[o];0!==s[i]&&(a=!1)}a&&(r.splice(t--,1),e=c(c.s=n[0]))}return e}var a={},s={app:0},r=[];function c(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=a,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)c.d(n,a,function(t){return e[t]}.bind(null,a));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],i=o.push.bind(o);o.push=t,o=o.slice();for(var d=0;d<o.length;d++)t(o[d]);var m=i;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0c17":function(e,t,n){},"1d98":function(e,t,n){"use strict";n("8d0a")},2185:function(e,t,n){"use strict";n("b1e5")},"39ed":function(e,t,n){},"3f0c":function(e,t,n){},"42c7":function(e,t,n){"use strict";n("3f0c")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("7a23"),s=Object(a["g"])("div",null,[Object(a["g"])("h1",null,"Chat")],-1);function r(e,t,n,r,c,o){var i=Object(a["w"])("the-navigator"),d=Object(a["w"])("member-info"),m=Object(a["w"])("the-notification"),u=Object(a["w"])("router-view");return Object(a["p"])(),Object(a["d"])(a["a"],null,[Object(a["g"])("header",null,[s,Object(a["g"])("div",null,[o.isAuthenticated?(Object(a["p"])(),Object(a["d"])(i,{key:0})):Object(a["e"])("",!0)]),Object(a["g"])("div",null,[o.isAuthenticated?(Object(a["p"])(),Object(a["d"])(d,{key:0})):Object(a["e"])("",!0)])]),Object(a["g"])("main",null,[o.notification?(Object(a["p"])(),Object(a["d"])(m,{key:0,message:o.notification.text,level:o.notification.level},null,8,["message","level"])):Object(a["e"])("",!0),Object(a["g"])(u)])],64)}var c=n("1da1"),o=(n("96cf"),Object(a["C"])("data-v-1c9f89e6"));Object(a["s"])("data-v-1c9f89e6");var i=Object(a["f"])("Chat"),d=Object(a["f"])("Visualization");Object(a["q"])();var m=o((function(e,t,n,s,r,c){var m=Object(a["w"])("router-link");return Object(a["p"])(),Object(a["d"])("nav",null,[Object(a["g"])("ul",null,[Object(a["g"])("li",null,[Object(a["g"])(m,{to:"/chat"},{default:o((function(){return[i]})),_:1})]),Object(a["g"])("li",null,[Object(a["g"])(m,{to:"/visualization"},{default:o((function(){return[d]})),_:1})])])])})),u={name:"TheNavigator"};n("724f");u.render=m,u.__scopeId="data-v-1c9f89e6";var l=u,b=Object(a["C"])("data-v-56cf6653");Object(a["s"])("data-v-56cf6653");var g={class:"message"};Object(a["q"])();var p=b((function(e,t,n,s,r,c){return Object(a["p"])(),Object(a["d"])("div",g,[Object(a["g"])("span",{class:{error:"error"===n.level}},Object(a["y"])(n.message),3)])})),f={name:"TheNotification",props:["message","level"]};n("d713");f.render=p,f.__scopeId="data-v-56cf6653";var h=f,v=Object(a["C"])("data-v-4cefafbe");Object(a["s"])("data-v-4cefafbe");var k=Object(a["f"])(" Your nickname is: ");Object(a["q"])();var O=v((function(e,t,n,s,r,c){return Object(a["p"])(),Object(a["d"])(a["a"],null,[Object(a["g"])("span",null,[k,Object(a["g"])("strong",null,Object(a["y"])(c.nickname),1)]),Object(a["g"])("button",{onClick:t[1]||(t[1]=function(e){return c.leave()})},"Leave")],64)})),j={name:"MemberInfo",computed:{nickname:function(){return this.$store.getters["chat/nickname"]}},methods:{leave:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("chat/leave");case 2:e.$router.push("/");case 3:case"end":return t.stop()}}),t)})))()}}};n("1d98");j.render=O,j.__scopeId="data-v-4cefafbe";var I=j,S={name:"App",components:{MemberInfo:I,TheNotification:h,TheNavigator:l},created:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("chat/loadSession");case 2:case"end":return t.stop()}}),t)})))()},computed:{isAuthenticated:function(){return this.$store.getters["chat/isAuthenticated"]},notification:function(){return this.$store.getters.notification}}};n("a443");S.render=r;var y=S,M=n("6c02"),T=Object(a["C"])("data-v-3607b7a2");Object(a["s"])("data-v-3607b7a2");var w={class:"form"},C={class:"form-control"},E=Object(a["g"])("label",{for:"nickname"},"Nickname:",-1),_={type:"text",id:"nickname",ref:"nickname"},A={key:0,class:"form-message"},R={class:"error"},D=Object(a["g"])("div",null,[Object(a["g"])("button",null,"Join")],-1);Object(a["q"])();var N=T((function(e,t,n,s,r,c){return Object(a["p"])(),Object(a["d"])("div",w,[Object(a["g"])("form",{onSubmit:t[1]||(t[1]=Object(a["B"])((function(){return c.doLogin&&c.doLogin.apply(c,arguments)}),["prevent"]))},[Object(a["g"])("div",C,[E,Object(a["g"])("input",_,null,512)]),r.errorMessage?(Object(a["p"])(),Object(a["d"])("div",A,[Object(a["g"])("span",R,Object(a["y"])(r.errorMessage),1)])):Object(a["e"])("",!0),D],32)])})),x={name:"MemberLogin",data:function(){return{errorMessage:null}},methods:{doLogin:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$store.dispatch("chat/join",{nickname:e.$refs.nickname.value});case 3:e.$router.push("/chat"),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),e.errorMessage=t.t0.message||"Could not join the chat";case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))()}}};n("2185");x.render=N,x.__scopeId="data-v-3607b7a2";var L=x,$=Object(a["C"])("data-v-e59ac87c");Object(a["s"])("data-v-e59ac87c");var U={class:"chat-box"},B={class:"chat-members-list"},J={class:"chat-conversation"};Object(a["q"])();var G=$((function(e,t,n,s,r,c){var o=Object(a["w"])("chat-members-list"),i=Object(a["w"])("chat-conversation");return Object(a["p"])(),Object(a["d"])("div",U,[Object(a["g"])("div",B,[Object(a["g"])(o,{"target-member-id":r.targetMemberId,"onUpdate:target-member-id":t[1]||(t[1]=function(e){return r.targetMemberId=e})},null,8,["target-member-id"])]),Object(a["g"])("div",J,[c.targetMember?(Object(a["p"])(),Object(a["d"])(i,{key:0,"target-member":c.targetMember,disabled:c.disabled},null,8,["target-member","disabled"])):Object(a["e"])("",!0)])])})),P=Object(a["C"])("data-v-3276f6b9");Object(a["s"])("data-v-3276f6b9");var q={key:0};Object(a["q"])();var V=P((function(e,t,n,s,r,c){return Object(a["p"])(),Object(a["d"])(a["a"],null,[Object(a["g"])("ul",null,[(Object(a["p"])(!0),Object(a["d"])(a["a"],null,Object(a["v"])(c.membersList,(function(e){return Object(a["p"])(),Object(a["d"])("li",{key:e.id,class:{online:e.onlineSince,offline:!e.onlineSince,selected:e.memberId===n.targetMemberId},onClick:function(t){return c.selectMember(e.memberId)},title:c.getOnlineStatus(e)},Object(a["y"])(e.nickname),11,["onClick","title"])})),128))]),c.membersList.length?Object(a["e"])("",!0):(Object(a["p"])(),Object(a["d"])("p",q,"No other chat members"))],64)})),z=(n("07ac"),{name:"ChatMembers",emits:["update:targetMemberId"],props:["targetMemberId"],computed:{membersList:function(){return Object.values(this.$store.getters["members/members"]).sort((function(e,t){return e.nickname>t.nickname?1:-1}))}},methods:{selectMember:function(e){this.$emit("update:targetMemberId",e)},getOnlineStatus:function(e){return e.onlineSince?"Online since "+new Date(e.onlineSince).toLocaleString():"Offline"}}});n("e4cd");z.render=V,z.__scopeId="data-v-3276f6b9";var K=z,H=Object(a["C"])("data-v-528f446d");Object(a["s"])("data-v-528f446d");var F={class:"chat-conversation-box"},W={class:"chat-messages-list"},Y={class:"chat-notification"},Q={class:"chat-input"};Object(a["q"])();var X=H((function(e,t,n,s,r,c){var o=Object(a["w"])("chat-messages-list"),i=Object(a["w"])("chat-status-bar"),d=Object(a["w"])("chat-input");return Object(a["p"])(),Object(a["d"])("div",F,[Object(a["g"])("div",W,[Object(a["g"])(o,{"target-member-id":n.targetMember.memberId},null,8,["target-member-id"])]),Object(a["g"])("div",Y,[Object(a["g"])(i,{"status-text":c.statusText},null,8,["status-text"])]),Object(a["g"])("div",Q,[Object(a["g"])(d,{"target-member-id":n.targetMember.memberId,disabled:n.disabled},null,8,["target-member-id","disabled"])])])})),Z=Object(a["C"])("data-v-13006494");Object(a["s"])("data-v-13006494");var ee={class:"timestamp"},te=Object(a["g"])("span",{class:"placeholder"},null,-1);Object(a["q"])();var ne=Z((function(e,t,n,s,r,c){return Object(a["p"])(),Object(a["d"])("ul",null,[(Object(a["p"])(!0),Object(a["d"])(a["a"],null,Object(a["v"])(c.messagesList,(function(e){return Object(a["p"])(),Object(a["d"])("li",{key:e.messageId,class:{"our-message":e.isOur,"their-message":!e.isOur,unread:!e.readAt}},[Object(a["g"])("span",ee,Object(a["y"])(c.formatTimestamp(e.sentAt)),1),te,Object(a["f"])(" "+Object(a["y"])(e.message),1)],2)})),128))])})),ae={name:"ChatMessagesList",props:["targetMemberId"],computed:{messagesList:function(){return this.$store.getters["messages/messages"](this.targetMemberId)||[]}},watch:{messagesList:function(e){for(var t=this.$store.getters["chat/memberId"],n=this.$store.getters["messages/lastReadMessage"](t)||-1,a=n+1;a<e.length;a++)e[a].isOur||this.$store.dispatch("messages/markReceivedMessageAsRead",{messageId:e[a].messageId,senderId:e[a].senderId})}},methods:{formatTimestamp:function(e){return new Date(e).toLocaleString()}}};n("cf3b");ae.render=ne,ae.__scopeId="data-v-13006494";var se=ae,re=Object(a["C"])("data-v-6be11bf8"),ce=re((function(e,t,n,s,r,c){return Object(a["p"])(),Object(a["d"])("form",{onSubmit:t[3]||(t[3]=Object(a["B"])((function(e){return c.submit()}),["prevent"]))},[Object(a["g"])("input",{type:"text",ref:"message",onBlur:t[1]||(t[1]=function(e){return c.blur()}),onKeypress:t[2]||(t[2]=function(e){return c.keypress()}),disabled:n.disabled},null,40,["disabled"]),Object(a["g"])("button",{disabled:n.disabled},"Send",8,["disabled"])],32)})),oe={name:"ChatInput",props:["targetMemberId","disabled"],data:function(){return{isTyping:!1,sendingMessage:!1}},methods:{submit:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.$store.getters["chat/memberId"],e.$store.dispatch({type:"messages/addMessage",senderId:n,recipientId:e.targetMemberId,message:e.$refs.message.value}),e.$refs.message.value=null,e.isTyping=!1;case 4:case"end":return t.stop()}}),t)})))()},blur:function(){this.isTyping&&(this.isTyping=!1,this.$store.dispatch("chat/notifyMemberStoppedTyping",this.targetMemberId))},keypress:function(){this.isTyping||(this.isTyping=!0,this.$store.dispatch("chat/notifyMemberStartedTyping",this.targetMemberId))}}};n("42c7");oe.render=ce,oe.__scopeId="data-v-6be11bf8";var ie=oe,de=Object(a["C"])("data-v-4279ddba"),me=de((function(e,t,n,s,r,c){return Object(a["p"])(),Object(a["d"])("span",null,Object(a["y"])(n.statusText),1)})),ue={name:"ChatStatusBar",props:["statusText"]};n("66b5");ue.render=me,ue.__scopeId="data-v-4279ddba";var le=ue,be={name:"ChatConversation",components:{ChatStatusBar:le,ChatInput:ie,ChatMessagesList:se},props:["targetMember","disabled"],computed:{statusText:function(){var e=this.$store.getters["members/memberStatus"][this.targetMember.memberId];return"typing"===e?"".concat(this.targetMember.nickname," is typing"):null}}};n("d78a");be.render=X,be.__scopeId="data-v-528f446d";var ge=be,pe={name:"ChatBox",components:{ChatConversation:ge,ChatMembersList:K},data:function(){return{targetMemberId:null}},computed:{targetMember:function(){return this.$store.getters["members/members"][this.targetMemberId]},disabled:function(){var e;return!this.$store.getters["chat/connected"]||!(null!==(e=this.targetMember)&&void 0!==e&&e.onlineSince)}},created:function(){this.$store.dispatch("members/loadMembers")}};n("ca12");pe.render=G,pe.__scopeId="data-v-e59ac87c";var fe=pe,he=Object(a["C"])("data-v-23acef96"),ve=he((function(e,t,n,s,r,c){return Object(a["p"])(),Object(a["d"])("div")})),ke={name:"MessagesVisualization"};ke.render=ve,ke.__scopeId="data-v-23acef96";var Oe=ke,je=n("5502"),Ie=(n("a15b"),n("d4ec")),Se=n("bee2"),ye=(n("d3b7"),"/api"),Me=function(){function e(){Object(Ie["a"])(this,e)}return Object(Se["a"])(e,[{key:"join",value:function(e){return console.log("Joining chat as ".concat(e)),fetch(ye+"/auth/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:e})}).then((function(e){return e.ok?e.json():e.json().then((function(e){throw new Error(e.message||"Server communication failed")}))}))}},{key:"leave",value:function(e){return console.log("Leaving chat"),fetch(ye+"/auth/leave",{method:"POST",headers:{Authorization:e}}).then((function(e){if(e.ok)return e}))}},{key:"loadMembers",value:function(e){return console.log("Loading chat members list"),fetch(ye+"/members",{headers:{Authorization:e}}).then((function(e){return e.ok?e.json():e.json().then((function(e){throw new Error(e.message||"Server communication failed")}))}))}}]),e}(),Te=n("ade3"),we=function(){function e(){Object(Ie["a"])(this,e),Object(Te["a"])(this,"newMessageCallback",null),Object(Te["a"])(this,"messageReadCallback",null),Object(Te["a"])(this,"startedTypingCallback",null),Object(Te["a"])(this,"stoppedTypingCallback",null),Object(Te["a"])(this,"memberJoinedCallback",null),Object(Te["a"])(this,"memberBecameAwayCallback",null),Object(Te["a"])(this,"memberLeftCallback",null),Object(Te["a"])(this,"newMessageTraceCallback",null),Object(Te["a"])(this,"startedTypingTraceCallback",null),Object(Te["a"])(this,"stoppedTypingTraceCallback",null),Object(Te["a"])(this,"socketConnectedCallback",null),Object(Te["a"])(this,"socketDisconnectedCallback",null),Object(Te["a"])(this,"socketErrorCallback",null),Object(Te["a"])(this,"socket",null),Object(Te["a"])(this,"pingHandler",null)}return Object(Se["a"])(e,[{key:"connect",value:function(e,t){var n=this;null!=e&&(this.socket=new WebSocket(e,t),this.socket.onopen=function(){console.log("Chat socket connected"),n.socketConnectedCallback&&n.socketConnectedCallback(),n.pingHandler=setInterval((function(){n.checkSocket()||n.stopPinging(),n.socket.send('{"_type":"UpstreamPing"}')}),3e4)},this.socket.onclose=function(e){n.stopPinging(),e.wasClean?console.log("Chat socket disconnected"):console.error("Chat socket terminated, code="+e.code+", reason: "+e.reason),n.socketDisconnectedCallback&&n.socketDisconnectedCallback()},this.socket.onmessage=function(e){var t=JSON.parse(e.data);switch(t["_type"]){case"DownstreamNewMessage":console.log("Received DownstreamNewMessage",t),n.newMessageCallback&&n.newMessageCallback({messageId:t.messageId,senderId:t.senderId,message:t.message,sentAt:t.timestamp});break;case"DownstreamMessageRead":console.log("Received DownstreamMessageRead",t),n.messageReadCallback&&n.messageReadCallback({messageId:t.messageId,recipientId:t.recipientId,readAt:t.timestamp});break;case"DownstreamStartedTyping":console.log("Received DownstreamStartedTyping",t),n.startedTypingCallback&&n.startedTypingCallback({memberId:t.memberId});break;case"DownstreamStoppedTyping":console.log("Received DownstreamStoppedTyping",t),n.stoppedTypingCallback&&n.stoppedTypingCallback({memberId:t.memberId});break;case"DownstreamMemberJoined":console.log("Received DownstreamMemberJoined",t),n.memberJoinedCallback&&n.memberJoinedCallback({memberId:t.memberId,nickname:t.nickname,onlineSince:t.onlineSince});break;case"DownstreamMemberIsAway":console.log("Received DownstreamMemberIsAway",t),n.memberBecameAwayCallback&&n.memberBecameAwayCallback({memberId:t.memberId});break;case"DownstreamMemberLeft":console.log("Received DownstreamMemberLeft",t),n.memberLeftCallback&&n.memberLeftCallback({memberId:t.memberId});break;case"DownstreamNewMessageTrace":console.log("Received DownstreamNewMessageTrace",t),n.newMessageTraceCallback&&n.newMessageTraceCallback({senderId:t.senderId,recipientId:t.recipientId});break;case"DownstreamStartedTypingTrace":console.log("Received DownstreamStartedTypingTrace",t),n.startedTypingTraceCallback&&n.startedTypingTraceCallback({senderId:t.senderId,recipientId:t.recipientId});break;case"DownstreamStoppedTypingTrace":console.log("Received DownstreamStoppedTypingTrace",t),n.stoppedTypingCallback&&n.stoppedTypingCallback({senderId:t.senderId,recipientId:t.recipientId});break;case"DownstreamPong":break;default:console.warn("Could not identify message",t)}},this.socket.onerror=function(e){n.stopPinging(),console.error("Chat socket error",e),n.socketErrorCallback&&n.socketErrorCallback(e)})}},{key:"disconnect",value:function(){this.socket.close(),console.log("Chat socket disconnected")}},{key:"sendMessage",value:function(e){var t=e.messageId,n=e.recipientId,a=e.message;if(this.checkSocket()){var s={_type:"UpstreamNewMessage",messageId:t,recipientId:n,message:a};console.log("Sending UpstreamNewMessage",s),this.socket.send(JSON.stringify(s))}}},{key:"confirmMessageRead",value:function(e,t){if(this.checkSocket()){var n={_type:"UpstreamMessageRead",messageId:e,senderId:t};console.log("Sending UpstreamNewMessage",n),this.socket.send(JSON.stringify(n))}}},{key:"notifyMemberStartedTyping",value:function(e){if(this.checkSocket()){var t={_type:"UpstreamStartedTyping",memberId:e};console.log("Sending UpstreamStartedTyping",t),this.socket.send(JSON.stringify(t))}}},{key:"notifyMemberStoppedTyping",value:function(e){if(this.checkSocket()){var t={_type:"UpstreamStoppedTyping",memberId:e};console.log("Sending UpstreamStoppedTyping",t),this.socket.send(JSON.stringify(t))}}},{key:"checkSocket",value:function(){return!(!this.socket||1!==this.socket.readyState)||(console.error("Web socket is not opened"),!1)}},{key:"stopPinging",value:function(){this.pingHandler&&(clearInterval(this.pingHandler),this.pingHandler=null)}},{key:"onNewMessage",value:function(e){return this.newMessageCallback=e,this}},{key:"onMessageRead",value:function(e){return this.messageReadCallback=e,this}},{key:"onStartedTyping",value:function(e){return this.startedTypingCallback=e,this}},{key:"onStoppedTyping",value:function(e){return this.stoppedTypingCallback=e,this}},{key:"onMemberJoined",value:function(e){return this.memberJoinedCallback=e,this}},{key:"onMemberBecameAway",value:function(e){return this.memberBecameAwayCallback=e,this}},{key:"onMemberLeft",value:function(e){return this.memberLeftCallback=e,this}},{key:"onNewMessageTrace",value:function(e){return this.newMessageTraceCallback=e,this}},{key:"onStartedTypingTrace",value:function(e){return this.startedTypingTraceCallback=e,this}},{key:"onStoppedTypingTrace",value:function(e){return this.stoppedTypingTraceCallback=e,this}},{key:"onSocketConnected",value:function(e){return this.socketConnectedCallback=e,this}},{key:"onSocketDisconnected",value:function(e){return this.socketDisconnectedCallback=e,this}},{key:"onSocketError",value:function(e){return this.socketErrorCallback=e,this}}]),e}(),Ce=new Me,Ee=new we,_e={namespaced:!0,state:function(){return{memberId:null,nickname:null,chatSocketUrl:null,sessionToken:null,connected:!1,notification:{text:null,level:null}}},mutations:{SET_SESSION:function(e,t){var n,a;e.memberId=null===t||void 0===t||null===(n=t.member)||void 0===n?void 0:n.memberId,e.nickname=null===t||void 0===t||null===(a=t.member)||void 0===a?void 0:a.nickname,e.sessionToken=null===t||void 0===t?void 0:t.sessionToken,e.chatSocketUrl=null===t||void 0===t?void 0:t.chatSocketUrl},SET_CONNECTED:function(e,t){e.connected=t},SET_NOTIFICATION:function(e,t){e.notification=t}},actions:{loadSession:function(e){return Object(c["a"])(regeneratorRuntime.mark((function t(){var n,a,s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=localStorage.getItem("memberId"),a=localStorage.getItem("nickname"),s=localStorage.getItem("sessionToken"),r=localStorage.getItem("chatSocketUrl"),n&&a&&s&&r){t.next=9;break}if(!(n||a||s||r)){t.next=8;break}return t.next=8,e.dispatch("clearSession");case 8:return t.abrupt("return",null);case 9:e.commit("SET_SESSION",{member:{memberId:n,nickname:a},sessionToken:s,chatSocketUrl:r}),Ee.connect(e.state.chatSocketUrl,e.state.sessionToken);case 11:case"end":return t.stop()}}),t)})))()},clearSession:function(){localStorage.removeItem("memberId"),localStorage.removeItem("nickname"),localStorage.removeItem("sessionToken"),localStorage.removeItem("chatSocketUrl")},join:function(e,t){return Object(c["a"])(regeneratorRuntime.mark((function n(){var a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.nickname,console.log("Joining the chat as ".concat(a)),n.next=4,Ce.join(a);case 4:s=n.sent,e.commit("SET_SESSION",s),Ee.connect(e.state.chatSocketUrl,e.state.sessionToken),localStorage.setItem("memberId",e.state.memberId),localStorage.setItem("nickname",e.state.nickname),localStorage.setItem("sessionToken",e.state.sessionToken),localStorage.setItem("chatSocketUrl",e.state.chatSocketUrl);case 11:case"end":return n.stop()}}),n)})))()},leave:function(e){return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Leaving the chat"),Ee.disconnect(),t.next=4,Ce.leave(e.state.sessionToken);case 4:return e.commit("SET_SESSION",null),t.next=7,e.dispatch("clearSession");case 7:case"end":return t.stop()}}),t)})))()},setSocketConnected:function(e){e.commit("SET_CONNECTED",!0)},setSocketDisconnected:function(e){var t=e.state.connected;e.commit("SET_CONNECTED",!1),t?e.commit("SET_NOTIFICATION",{text:"Server connection lost",level:"error"}):e.commit("SET_NOTIFICATION",null)},setSocketError:function(e){e.state.connected||e.dispatch("leave",null)},notifyMemberStartedTyping:function(e,t){Ee.notifyMemberStartedTyping(t)},notifyMemberStoppedTyping:function(e,t){Ee.notifyMemberStoppedTyping(t)}},getters:{isAuthenticated:function(e){return!!e.sessionToken},memberId:function(e){return e.memberId},nickname:function(e){return e.nickname},sessionToken:function(e){return e.sessionToken},connected:function(e){return e.connected}}};function Ae(){return function(e){Ee.onNewMessage((function(t){e.dispatch("messages/receiveMessage",t),e.dispatch("members/setMemberStatus",{memberId:t.senderId,status:null})})).onMessageRead((function(t){e.dispatch("messages/markSentMessageAsRead",t)})).onStartedTyping((function(t){e.dispatch("members/setMemberStatus",{memberId:t.memberId,status:"typing"})})).onStoppedTyping((function(t){e.dispatch("members/setMemberStatus",{memberId:t.memberId,status:null})})).onMemberJoined((function(t){e.dispatch("members/joinMember",t)})).onMemberBecameAway((function(t){e.dispatch("members/markAsAway",t)})).onMemberLeft((function(t){e.dispatch("members/leaveMember",t)})).onSocketConnected((function(){e.dispatch("chat/setSocketConnected")})).onSocketDisconnected((function(){e.dispatch("chat/setSocketDisconnected")})).onSocketError((function(){e.dispatch("chat/setSocketError")})),e.subscribe((function(e,t){t.chat.connected&&("messages/ADD_MESSAGE"===e.type?Ee.sendMessage(e.payload):"messages/MARK_RECEIVED_MESSAGE_AS_READ"===e.type&&Ee.confirmMessageRead(e.payload.messageId,e.payload.senderId))}))}}var Re=Ae();n("99af"),n("25f0");function De(e,t,n){if(!e.messages[t])return console.warn("No conversation with ".concat(t)),null;for(var a=e.messages[t].length-1;a>=0;a--)if(e.messages[t][a].messageId===n)return a;return console.warn("No message with id=".concat(n," in conversation with ").concat(t)),null}var Ne={namespaced:!0,state:function(){return{messages:{},lastReadMessage:{}}},mutations:{RECEIVE_MESSAGE:function(e,t){var n=t.messageId,a=t.senderId,s=t.recipientId,r=t.message,c=t.sentAt,o=t.readAt;e.messages[a]||(e.messages[a]=[]),e.messages[a].push({messageId:n,senderId:a,recipientId:s,message:r,sentAt:c,readAt:o,isOur:!1})},ADD_MESSAGE:function(e,t){var n=t.messageId,a=t.senderId,s=t.recipientId,r=t.message,c=t.sentAt,o=t.readAt;e.messages[s]||(e.messages[s]=[]),e.messages[s].push({messageId:n,senderId:a,recipientId:s,message:r,sentAt:c,readAt:o,isOur:!0})},MARK_SENT_MESSAGE_AS_READ:function(e,t){var n=t.messageId,a=t.recipientId,s=t.readAt,r=De(e,a,n);null!=r&&(e.messages[a][r].readAt=s)},MARK_RECEIVED_MESSAGE_AS_READ:function(e,t){var n=t.messageId,a=t.senderId,s=De(e,a,n);null!=s&&(e.messages[a][s].readAt=Date.now(),e.lastReadMessage[a]=s)}},getters:{messages:function(e){return function(t){return e.messages[t]}},lastReadMessage:function(e){return function(t){return e.lastReadMessage[t]}}},actions:{receiveMessage:function(e,t){var n=t.messageId,a=t.senderId,s=t.message,r=t.sentAt,c=e.rootGetters["chat/memberId"];e.commit("RECEIVE_MESSAGE",{messageId:n,senderId:a,recipientId:c,message:s,sentAt:r,readAt:null})},addMessage:function(e,t){var n=t.recipientId,a=t.message,s=e.rootGetters["chat/memberId"];e.commit("ADD_MESSAGE",{messageId:s+"-"+n+"-"+Date.now().toString(),senderId:s,recipientId:n,message:a,sentAt:Date.now(),readAt:null})},markSentMessageAsRead:function(e,t){var n=t.messageId,a=t.recipientId,s=t.readAt;e.commit("MARK_SENT_MESSAGE_AS_READ",{messageId:n,recipientId:a,readAt:s})},markReceivedMessageAsRead:function(e,t){var n=t.messageId,a=t.senderId;e.commit("MARK_RECEIVED_MESSAGE_AS_READ",{messageId:n,senderId:a})}}},xe=n("5530"),Le={namespaced:!0,state:function(){return{members:{},memberStatus:{}}},mutations:{SET_MEMBERS:function(e,t){e.members=t},MERGE_MEMBER:function(e,t){var n=e.members[t.memberId]||{};e.members[t.memberId]=Object(xe["a"])(Object(xe["a"])({},n),t)},DELETE_MEMBER:function(e,t){var n=t.memberId;delete e.members[n],delete e.memberStatus[n]},SET_MEMBER_STATUS:function(e,t){var n=t.memberId,a=t.status;e.memberStatus[n]=a}},getters:{members:function(e){return e.members},memberStatus:function(e){return e.memberStatus}},actions:{loadMembers:function(e){return Object(c["a"])(regeneratorRuntime.mark((function t(){var n,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.rootGetters["chat/sessionToken"],t.next=3,Ce.loadMembers(n);case 3:a=t.sent,s=a.reduce((function(e,t){return e[t.memberId]=t,e}),{}),e.commit("SET_MEMBERS",s);case 6:case"end":return t.stop()}}),t)})))()},joinMember:function(e,t){var n=t.memberId,a=t.nickname,s=t.onlineSince;e.commit("MERGE_MEMBER",{memberId:n,nickname:a,onlineSince:s})},markAsAway:function(e,t){var n=t.memberId;e.commit("SET_MEMBER_STATUS",{memberId:n,status:null}),e.commit("MERGE_MEMBER",{memberId:n,onlineSince:null})},leaveMember:function(e,t){var n=t.memberId;e.commit("DELETE_MEMBER",{memberId:n})},setMemberStatus:function(e,t){var n=t.memberId,a=t.status;e.commit("SET_MEMBER_STATUS",{memberId:n,status:a})}}},$e=Object(je["a"])({modules:{chat:_e,messages:Ne,members:Le},plugins:[Re]}),Ue=$e,Be=Object(M["a"])({history:Object(M["b"])(),routes:[{path:"/",redirect:"/login"},{path:"/login",component:L,meta:{requiresNotLoggedIn:!0}},{path:"/chat",component:fe,meta:{requiresLoggedIn:!0}},{path:"/visualization",component:Oe,meta:{requiresLoggedIn:!0}}]});Be.beforeEach((function(e,t,n){e.meta.requiresLoggedIn&&!Ue.getters["chat/isAuthenticated"]?n("/login"):e.meta.requiresNotLoggedIn&&Ue.getters["chat/isAuthenticated"]?n("/chat"):n()}));var Je=Be,Ge=Object(a["c"])(y);Ge.use(Je),Ge.use(Ue),Ge.mount("#app")},"5cb6":function(e,t,n){},"66b5":function(e,t,n){"use strict";n("7233")},7233:function(e,t,n){},"724f":function(e,t,n){"use strict";n("5cb6")},"77ba":function(e,t,n){},"888b":function(e,t,n){},"8d0a":function(e,t,n){},a443:function(e,t,n){"use strict";n("d5cc")},b1e5:function(e,t,n){},c86e:function(e,t,n){},ca12:function(e,t,n){"use strict";n("77ba")},cf3b:function(e,t,n){"use strict";n("39ed")},d5cc:function(e,t,n){},d713:function(e,t,n){"use strict";n("c86e")},d78a:function(e,t,n){"use strict";n("0c17")},e4cd:function(e,t,n){"use strict";n("888b")}});
//# sourceMappingURL=app.e7219de1.js.map